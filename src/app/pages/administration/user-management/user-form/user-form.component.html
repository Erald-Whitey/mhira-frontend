<nz-tabset>
  <nz-tab nzTitle="Profile">
    <app-form
      [isLoading]="isLoading"
      [loadingMessage]="loadingMessage"
      [inputMode]="inputMode"
      [showCancelButton]="showCancelButton"
      [form]="profileFields"
      (submitForm)="submitForm($event)"
    ></app-form>
  </nz-tab>
  <nz-tab
    *ngIf="
      !newMode &&
      !isCurrentUser() &&
      perms.permissionsOnly(['manage users', 'manage departments', 'manage users', 'manage roles'])
    "
    nzTitle="Security"
  >
    <div nz-row nzGutter="16">
      <div nz-col *ngIf="showIfPermissionIs('manage roles')">
        <nz-card style="width: 300px" nzTitle="{{ user.firstName }}'s Roles" [nzExtra]="rolesTemplate">
          <nz-checkbox-wrapper style="width: 100%" (nzOnChange)="collectRoles($event)">
            <div nz-row>
              <div nz-col nzSpan="24" *ngFor="let role of roles">
                <label nz-checkbox [nzValue]="role.id" [ngModel]="userHasRole(role.id)">{{ role.name }}</label>
              </div>
            </div>
          </nz-checkbox-wrapper>
        </nz-card>
        <ng-template #rolesTemplate>
          <a *ngIf="roles.length > 0" nz-button nzSize="small" (click)="submitRoles()">Save</a>
        </ng-template>
      </div>
      <div nz-col *ngIf="showIfPermissionIs('manage departments')">
        <nz-card style="width: 300px" nzTitle="{{ user.firstName }}'s Departments" [nzExtra]="departmentTemplate">
          <nz-checkbox-wrapper style="width: 100%" (nzOnChange)="collectDepartments($event)">
            <div nz-row>
              <div nz-col nzSpan="24" *ngFor="let department of departments">
                <label nz-checkbox [nzValue]="department.id" [ngModel]="userHasDepartment(department.id)">{{
                  department.name
                }}</label>
              </div>
            </div>
          </nz-checkbox-wrapper>
        </nz-card>
        <ng-template #departmentTemplate>
          <a *ngIf="departments.length > 0" nz-button nzSize="small" (click)="submitDepartments()">Save</a>
        </ng-template>
      </div>

      <div nz-col *ngIf="showIfPermissionIs('manage users')">
        <nz-card style="width: 300px" nzTitle="Enable or Disable {{ user.firstName }}">
          <p>To disable and Enable {{ user.firstName }} toggle the switch below.</p>
          <nz-switch (ngModelChange)="activateUser(user)" [(ngModel)]="user.active"></nz-switch>
        </nz-card>
      </div>
      <div nz-col>
        <nz-card style="width: 300px" nzTitle="Change {{ user.firstName }}'s password">
          <p>To change password for {{ user.firstName }} toggle the button below.</p>
          <button (click)="showChangePasswordForm()" nz-button nzType="primary">Change Password</button>
        </nz-card>
      </div>
    </div>
  </nz-tab>
</nz-tabset>
<nz-modal
  [(nzVisible)]="showModal"
  [nzTitle]="modalType?.title"
  (nzOnCancel)="handleCancel()"
  (nzOnOk)="clickChangePassword()"
>
  <app-form
    [isLoading]="isLoading"
    [showSubmitButton]="false"
    [showCancelButton]="false"
    [loadingMessage]="loadingMessage"
    (submitForm)="submitForm($event)"
    [form]="updatePasswordForm"
  ></app-form>
</nz-modal>
